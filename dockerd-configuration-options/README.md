# dockerd-configuration-options/

This xxXXXxxx

#### WARNING: These instructions are incomplete. Consider them as notes quickly drafted on a napkin rather than proper documentation!


 * 

## System OS script tested

    Ubuntu 14.04.3 LTS
    Ubuntu 16.04.3 LTS

## Install

XXXXX

To install, change directory to the location you want to download the scripts. Use git to pull or clone these scripts into the directory. If you do not have git then enter; "sudo apt-get install git". On the github page of this script use the "HTTPS clone URL" with the 'git clone' command.

    git clone https://github.com/BradleyA/docker-scripts
    cd docker-scripts

#### Design Principles
 * Have a simple setup process and a minimal learning curve
 * Be usable as non-root - [failed]
 * Be easy to install and configure

## License::

Permission is hereby granted, free of charge, to any person obtaining a copy of this software, associated documentation, and files (the "Software") without restriction, including without limitation of rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#######
# Need to clean this up once I get everything working for Ubuntu 14.04 and Ubuntu 16.04

setup-dockerd-configuration-file

The docker daemon flags will be written to /etc/systemd/system/docker.service.d/override.conf by default for Ubuntu 16.04 (systemd) and /etc/default/docker for Ubuntu 14.04 (Upstart)

1) Download the file below; 
	440	10-override
	640	dockerd-configuration-file
		dockerd-configuration-file.service
		dockerd-configuration-file.upstart
2) Append dockerd-configuration-file to /etc/default/docker for ubuntu 14.04 upstart docker daemon
3) Run dockerd-configuration-file.service as a service to create $OVERRIDE_FILE before sudo systemctl start docker so this service is a pre-req of docker.service will need to add that to dockerd-configuration-file.service
 

Contents of $OVERRIDE_FILE created after each reboot by the above lines
 [
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN"
[Service]
ExecStart=/usr/bin/dockerd $DOCKER_OPTS
 ]
Contents of 644 dockerd-configuration-file.service
 [
	[Unit]
	Description=dockerd-configuration-file.service
	Documentation=https://github.com/x x x x x x/setup-dockerd-configuration-file
	Requires=systemd-networkd-wait-online.service
	After=systemd-networkd-wait-online.service

	[Service]
	ExecStartPre=OVERRIDE_FILE="/etc/systemd/system/docker.service.d/10-override.conf"
	ExecStartPre=-source /etc/default/docker
	ExecStartPre=-/usr/bin/mkdir -p /etc/systemd/system/docker.service.d
	ExecStartPre=/bin/echo "#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN" > $OVERRIDE_FILE
	ExecStartPre=/bin/echo "[Service]" >> $OVERRIDE_FILE
	ExecStartPre=/bin/echo "ExecStart=/usr/bin/dockerd " $DOCKER_OPTS >> $OVERRIDE_FILE
	ExecStart=/usr/bin/chmod 644 $OVERRIDE_FILE
	RemainAfterExit=yes
	Type=oneshot
 ]
Contents of dockerd-configuration-file
 [
	### Use DOCKER_OPTS to modify the daemon startup options.
	#
	#   Enable debug mode. Default is false
#       --debug=true
#   IPv4 address of the container default gateway; this address must be part of the bridge subnet (which is defined by -b or --bip)
#       --default-gateway=""
# * Path to use as the root of the Docker runtime. Default is /var/lib/docker
#       --data-root=""
# * Force Docker to use specific DNS servers
#       --dns
#   Enable the daemon experimental features.dd
#       --experimental=""
# * The socket(s) to bind to in daemon mode specified using one or more tcp://host:port, unix:///path/to/socket, fd://* or fd://socketfd.
#       -H, --host=[unix:///var/run/docker.sock]: tcp://[host:port] to bind or unix://[/path/to/socket] to use.
# * Set key=value labels to the daemon (displayed in docker info)
#       --label="[]"      `docker version | grep -m 1 Version: |  awk '{ print $2 }'`
#   Enable live restore of running containers when the daemon starts so that they are not restarted. The live restore option is not compatible with Docker Engine swarm mode.
#       --live-restore=false
# * Set the logging level. Default is info.
#       --log-level="debug|info|warn|error|fatal"
# * Default driver for container logs. Default is json-file.  Warning: docker logs command works only for json-file logging driver.
#       --log-driver="json-file|syslog|journald|gelf|fluentd|awslogs|splunk|etwlogs|gcplogs|none"
# * Logging driver specific options.
#       --log-opt=[]
#   Path to use for daemon PID file. Default is /var/run/docker.pid
#       -p, --pidfile=""
#   Force the Docker runtime to use a specific storage driver. Currently default on Ubuntu AUFS
#       --storage-driver=overlay
# * Use TLS and verify the remote (daemon: verify client, client: verify daemon).  Default is false.
#       --tlsverify=true|false
#   Use TLS; implied by --tlsverify. Default is false.
#       --tls=true|false
# * Trust certs signed only by this CA.
#       --tlscacert= /.docker/ca.pem
# * Path to TLS certificate file.
#       --tlscert= /.docker/cert.pem
# * Path to TLS key file.
#       --tlskey= /.docker/key.pem
# * Enable user namespaces for containers on the daemon. Specifying "default" will cause a new user and group to be created to handle
#   UID and GID range remapping for the user namespace mappings used for contained processes.
#       --userns-remap=default|uid:gid|user:group|user|uid
###
DOCKER_OPTS="\
        --data-root=/usr/local/docker \
        --dns 192.168.1.202 \
        --dns 8.8.8.8 \
        --dns 8.8.4.4 \
        --host=`hostname -f`:2376 \
        --label XHOST=`hostname -f` \
        --label XIPADDRESS=`hostname -i` \
        --label XOS=`lsb_release -d | awk '{ print $2"-"$3"-"$4 }'` \
        --label XRELEASE=`docker version | grep -m 1 Version: |  awk '{ print $2 }'` \
        --label XSECURITY=namespace-control \
        --log-level warn \
        --log-driver=json-file \
        --log-opt max-size=5m \
        --log-opt max-file=7 \
        --log-opt labels=host,ip,gateway,id \
        --tlsverify \
        --tlscacert=/etc/docker/certs.d/daemon/ca.pem \
        --tlscert=/etc/docker/certs.d/daemon/`hostname -f`-cert.pem \
        --tlskey=/etc/docker/certs.d/daemon/`hostname -f`-priv-key.pem \
        --userns-remap=default \
        "
 ]

Note:
	echo "DOCKER_OPTS="\"$DOCKER_OPTS\" >> $OVERRIDE_FILE
	

